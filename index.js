(()=>{"use strict";var e={123:(e,t)=>{var o,n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PASS="pass",e.FAIL="fail",e.NOT_RUN="notRun",e.RUNNING="running",e.INFO="info",e.FATAL="fatal",e.WARN="warn",e.ALL="all"}(o||(o={})),function(e){e.NOT_APPLICABLE="Not Applicable",e.SCHEDULED="Scheduled",e.IN_PROGRESS="In Progress",e.COMPLETED="Completed",e.ABORTED="Aborted",e.FAILED="Failed To Start",e.RECURRING="Recurring",e.ERROR="Error",e.CONTINUOUS_INTEGRATION="Continuous Integration"}(n||(n={}));const r={LOG_DELIMITER:">>> ",USER_AGENT:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36",JOB_STATUS_POLL_TIME:3e4,JOB_PICKUP_RETRY_COUNT:30,JOB_WEB_LINK:"#/forward?entityType=9&resultId={0}",EXT_JOB_WEB_LINK:"#/resultext?tenant={0}&resultId={1}",API_VERSION:"1.0",AQ_RESULT_INFO_KEY:"AQReportInfo",TEST_CASE_STATUS:o,TEST_JOB_STATUS:n};t.default=r},86:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const o={validateJobID:e=>{try{if(+e<=0)return"Must be a number greater than 0"}catch(t){return"Not a number"}return null},validateTenantCode:function(e){return this.validateGenericField(e)},validateAppURL:e=>{try{new URL(e)}catch(t){return"Not a URL"}return null},validateGenericField:e=>{try{if(null==e||0==e.length)return"Cannot be empty"}catch(t){return"Cannot be empty"}return null},validateProjectCode:function(e){return this.validateGenericField(e)},validateAPIKey:function(e){return this.validateGenericField(e)},validateUserId:e=>{try{const t=new RegExp(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);if(null==e||0==e.length)return"Cannot be empty";if(!t.test(e))return"User ID must be in email format"}catch(t){}return null}};t.default=o},358:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,a){function s(e){try{i(n.next(e))}catch(t){a(t)}}function l(e){try{i(n.throw(e))}catch(t){a(t)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}i((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(o(123)),s=r(o(949)),l=r(o(376)),i=o(368),u={BASE_URL:"",API_ENDPOINT:"",PROXY_HOST:"",PROXY_PORT:80,setProxy:function(e,t){this.PROXY_HOST=e,this.PROXY_PORT=0==t?80:t},isProxySet:function(){return this.PROXY_HOST&&this.PROXY_HOST.length>0},getProxyConfig:function(){let e=this.BASE_URL.split("://")[0];return new s.default(`${e}://${this.PROXY_HOST}:${this.PROXY_PORT}`)},testConnection:function(e,t,o,r){return n(this,void 0,void 0,(function*(){const n=i.AQUtil.getRunParam(o,r);try{let r;this.isProxySet()&&(r=this.getProxyConfig());const s=yield l.default.request({method:"POST",url:`${this.API_ENDPOINT}/jobs/${o}/validate-ci-job`,httpsAgent:r,headers:{"User-Agent":a.default.USER_AGENT,API_KEY:e,USER_ID:t,"Content-Type":"application/json"},data:JSON.stringify(n)});return 200==s.status||s.status,""}catch(s){const e=s.response;return e&&404!=e.status?401==e.status?"Connection request failed. Please check connection parameters.":e.status>=500?"Server Error"+e.data.message:200!=e.status?"Template Job ID does not exist.":null:"Connection request failed. Please check the URL and Tenant Code."}}))},triggerJob:function(e,t,o,r){return n(this,void 0,void 0,(function*(){const n=i.AQUtil.getRunParam(o,r);try{let r;this.isProxySet()&&(r=this.getProxyConfig());const s=yield l.default.request({method:"PUT",url:`${this.API_ENDPOINT}/jobs/${o}/trigger-ci-job`,httpsAgent:r,headers:{"User-Agent":a.default.USER_AGENT,API_KEY:e,USER_ID:t,"Content-Type":"application/json"},data:JSON.stringify(n)}),i=s.data;return 200==s.status||204==s.status?{pid:i[0]}:i}catch(s){return console.log("Error is: "+s.response.data.message),null}}))},setBaseURL:function(e,t){this.BASE_URL="/"==e.charAt(e.length-1)?e:e+"/",this.API_ENDPOINT=this.BASE_URL+"awb/api/"+a.default.API_VERSION+"/"+t},getResultExternalAccessURL:function(e,t){let o=a.default.EXT_JOB_WEB_LINK;return o=o.replace("{0}",t),o=o.replace("{1}",e),this.BASE_URL+o},getJobSummary:function(e,t,o){return n(this,void 0,void 0,(function*(){let n;this.isProxySet()&&(n=this.getProxyConfig());return(yield l.default.request({method:"GET",httpsAgent:n,url:`${this.API_ENDPOINT}/runs/${e}`,headers:{"User-Agent":a.default.USER_AGENT,API_KEY:t,USER_ID:o,"Content-Type":"application/json"}})).data}))}};t.default=u},368:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AQUtil=void 0,t.AQUtil={getRunParam:(e,t)=>{let o={};return t&&t.length>0&&(o.runProperties=JSON.parse(t)),o.jobPid=+e,o},getRunParamJsonPayload:e=>{if(null==e||0==e.trim().length)return;const t=e.split("&");let o={};return t.forEach((e=>{const t=e.split("=");if(2==t.length){const e=t[0].trim(),n=t[1].trim();""!==e&&""!==n&&(o[e]=n)}})),JSON.stringify(o)},getFormattedTime:(e,t)=>{const o=new Date(e),n=new Date(t).getTime()-o.getTime(),r=+(n/1e3%60).toFixed(),a=+(n/6e4%60).toFixed(),s=+(n/36e5%24).toFixed(),l=+(n/864e5%365).toFixed();let i="";return 0!=l&&(i+=l>1?l+" days":l+" day"),0!=s&&(i+=s>1?s+" hrs":s+" hr"),0!=a&&(i+=" "+(a>1?a+" mins":a+" min")),0!=r&&(i+=" "+(r>1?r+" seconds":r+" second")),i}}},492:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,a){function s(e){try{i(n.next(e))}catch(t){a(t)}}function l(e){try{i(n.throw(e))}catch(t){a(t)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}i((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(o(123)),s=r(o(86)),l=r(o(358)),i=o(368),u=o(3);function c(e){return new Promise((t=>setTimeout(t,e)))}!function(){n(this,void 0,void 0,(function*(){try{const{appURL:e,userName:t,apiKey:o,tenantCode:r,jobId:d,runParam:f,proxyHost:p,proxyPort:T}=u.getInput();let h;if(console.log(e,t,o,r,d,p,T),h=s.default.validateAppURL(e),null!=h)throw new Error("ACCELQ App URL: "+h);if(h=s.default.validateUserId(t),null!=h)throw new Error("ACCELQ User ID: "+h);if(h=s.default.validateAPIKey(o),null!=h)throw new Error("API Key: "+h);if(h=s.default.validateTenantCode(r),null!=h)throw new Error("Tenant Code: "+h);if(h=s.default.validateJobID(d),null!=h)throw new Error("ACCELQ CI Job ID: "+h);if(h=yield function(e,t,o,r,a,s,u,c){return n(this,void 0,void 0,(function*(){l.default.setBaseURL(e,r),u&&u.length>0?l.default.setProxy(u,+c):l.default.setProxy("",0);const n=i.AQUtil.getRunParamJsonPayload(s);return yield l.default.testConnection(o,t,a,n)}))}(e,t,o,r,d,f,p,T),null===h)throw new Error("Something went wrong in extension");if(h)throw new Error(h);h=yield function(e,t,o,r,s,u,d,f){return n(this,void 0,void 0,(function*(){let n=null,p=0;try{l.default.setBaseURL(e,r),d&&d.length>0?l.default.setProxy(d,+f):l.default.setProxy("",0),console.log("******************************************"),console.log("*** Begin: ACCELQ Test Automation Step ***"),console.log("******************************************"),console.log();const T=i.AQUtil.getRunParamJsonPayload(u),h=yield l.default.triggerJob(o,t,s,T);if(null==h)throw new Error("Unable to submit the Job, check plugin log stack");if(null!=h.cause)throw new Error(h.cause);p=h.pid;let _=0,E=0,g=0,S=0,P="",A=0;const R=l.default.getResultExternalAccessURL(p.toString(),r);for(;;){if(n=yield l.default.getJobSummary(p,o,t),null!=n.cause)throw new Error(n.cause);if(null!=n.summary&&(n=n.summary),_=+n.pass,E=+n.fail,S=+n.notRun,0==A){const e=n.purpose,t=n.scnName,o=n.testSuiteName,r=n.testcaseCount;null!=o&&o.length>0?console.log("Test Suite Name: "+o):console.log("Scenario Name: "+t),console.log("Purpose: "+e),console.log("Total Test Cases: "+r),console.log(),console.log("Results Link: "+R),console.log("Need to abort? Click on the link above, login to ACCELQ and abort the run."),console.log()}if(P=n.status.toUpperCase(),P==a.default.TEST_JOB_STATUS.COMPLETED.toUpperCase()){const e=" "+i.AQUtil.getFormattedTime(n.startTimestamp,n.completedTimestamp);console.log("Status: "+n.status.toUpperCase()+" ("+e.trim()+")")}else console.log("Status: "+n.status.toUpperCase());if(g=_+E+S,console.log("Total "+g+": "+_+" Pass / "+E+" Fail"),console.log(),P==a.default.TEST_JOB_STATUS.SCHEDULED.toUpperCase()&&++A,A==a.default.JOB_PICKUP_RETRY_COUNT)throw new Error("No agent available to pickup the job");if(P==a.default.TEST_JOB_STATUS.COMPLETED.toUpperCase()||P==a.default.TEST_JOB_STATUS.ABORTED.toUpperCase()||P==a.default.TEST_JOB_STATUS.FAILED.toUpperCase()||P==a.default.TEST_JOB_STATUS.ERROR.toUpperCase())break;yield c(a.default.JOB_STATUS_POLL_TIME)}if(console.log("Results Link: "+R),console.log(),E>0||P==a.default.TEST_JOB_STATUS.ABORTED.toUpperCase()||P==a.default.TEST_JOB_STATUS.FAILED.toUpperCase()||P==a.default.TEST_JOB_STATUS.ERROR.toUpperCase())throw new Error(a.default.LOG_DELIMITER+"Run Failed");return console.log("**********************************************"),console.log("*** Completed: ACCELQ Test Automation Step ***"),console.log("**********************************************"),console.log(),{status:!0}}catch(T){if(n=yield l.default.getJobSummary(p,o,t),null!=n.cause)throw new Error(n.cause);return null!=n.summary&&(n=n.summary),console.log("Status: "+n.status),console.log("Pass: "+n.pass),{status:!1,error:T}}}))}(e,t,o,r,d,f,p,T),h.status?console.log("Run Completed!!!"):console.log('res.error?.message || "Job Failed!!!"')}catch(e){console.log(e.message)}}))}()},3:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getInput=void 0,t.getInput=function(){return{appURL:"http://localhost:9090",userName:"tenantadmin@accelq.com",apiKey:"X83h1iDFAOjwKTvxRqWwjcj7kaFa5Ksx94Qe0OGJ9p4",tenantCode:"accelq",jobId:"268",runParam:"",proxyHost:"http://915a46da3c96.ngrok.io ",proxyPort:"80"}}},376:e=>{e.exports=require("axios")},949:e=>{e.exports=require("https-proxy-agent")}},t={};(function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,o),a.exports})(492)})();